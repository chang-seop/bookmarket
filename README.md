## ê°œì¸ - ë¶ ìŠ¤í† ì–´ í† ì´ í”„ë¡œì íŠ¸

<hr/>

### âš¡í”„ë¡œì íŠ¸ ì†Œê°œ

#### ì‹œì‘í•˜ê²Œ ëœ ì´ìœ 
> - JPA, JPQL, Spring Data JPA, QueryDSL ìµìˆ™í•´ì§ˆ ìˆ˜ ìˆê²Œ ì—°ìŠµ
> - í…Œì´ë¸” ì„¤ê³„ ì—°ìŠµ
> - ê¶Œí•œì— ë”°ë¥¸ ì‚¬ìš©ì, íŒë§¤ì, ê´€ë¦¬ì ì—°ìŠµ (Spring Security)
> - ì§ˆì˜ N + 1 ë¬¸ì œ í•´ê²° ì—°ìŠµ (join fetch(ë‹¤ëŒ€ì¼), default_batch_fetch_size(ì¼ëŒ€ë‹¤ í˜ì´ì§• ì²˜ë¦¬))

<hr/>

### âš™ï¸ ê¸°ìˆ  ì •ë³´
<div>
<img src="https://img.shields.io/badge/Java-007396?style=flat-square&logo=java&logoColor=FFFFFF"/>
<img src="https://img.shields.io/badge/Spring-6DB33F?style=flat-square&logo=spring&logoColor=FFFFFF"/>
<img src="https://img.shields.io/badge/Spring Boot-6DB33F?style=flat-square&logo=springboot&logoColor=FFFFFF"/>
<img src="https://img.shields.io/badge/Spring Security-6DB33F?style=flat-square&logo=springsecurity&logoColor=FFFFFF"/>
<img src="https://img.shields.io/badge/MYSQL-4479A1?style=flat-square&logo=mysql&logoColor=FFFFFF"/>
<img src="https://img.shields.io/badge/H2 Database-4479A1.svg?&style=flat-square&logo=&logoColor=white">
<img src="https://img.shields.io/badge/Thymeleaf-005F0F.svg?&style=flat-square&logo=thymeleaf&logoColor=white">
<img src="https://img.shields.io/badge/JPA-59666C.svg?&style=flat-square&logo=Hibernate&logoColor=white">
<img src="https://img.shields.io/badge/Spring%20Data%20JPA-6DB33F.svg?&style=flat-square&logo=Spring&logoColor=white">
<img src="https://img.shields.io/badge/Querydsl-007ACC.svg?&style=flat-square&logoColor=white">

<hr/>

### ğŸš§ ìš”êµ¬ì‚¬í•­ ë° ì§„í–‰
#### ë©¤ë²„ ê¸°ëŠ¥ (ìœ ì €)
- [x] íšŒì›ê°€ì…
- [x] ë¡œê·¸ì¸
- [x] ë§ˆì´í˜ì´ì§€
- [x] í”„ë¡œí•„ & ë©¤ë²„ ìˆ˜ì •
- [x] ë‹‰ë„¤ì„, ì£¼ì†Œ ì´ë¦„ ìˆ˜ì •
- [x] í”„ë¡œí•„ ìƒë©” ìˆ˜ì •
- [x] í”„ë¡œí•„ ì´ë¯¸ì§€ ìˆ˜ì •
- [ ] í”„ë¡œí•„ ì´ë¯¸ì§€ëŠ” ìµœëŒ€ 1ê°œ ê²€ì¦

#### ë©¤ë²„ ê¸°ëŠ¥ (íŒë§¤ì)
- [x] íŒë§¤ì ë“±ë¡

#### ë©¤ë²„ ê¸°ëŠ¥ (ì–´ë“œë¯¼)
- [x] íŒë§¤ì ê¶Œí•œ ë“±ë¡ ì¡°íšŒ(í˜ì´ì§•)
- [x] íŒë§¤ì ê¶Œí•œ ë“±ë¡ ì„¸ë¶€ ì¡°íšŒ 
- [x] ê¶Œí•œ ë¶€ì—¬, ì·¨ì†Œ

#### ì±… ìƒí’ˆ ê¸°ëŠ¥ (íŒë§¤ì)
- [x] ìƒí’ˆ, ì´ë¯¸ì§€ ë“±ë¡
- [ ] ë“±ë¡, ìˆ˜ì •ì‹œ ë©”ì¸ ì´ë¯¸ì§€ëŠ” ìµœëŒ€ 1ê°œ ê²€ì¦, ì„œë¸Œ ì´ë¯¸ì§€ëŠ” ìµœëŒ€ 5ê°œ ê²€ì¦
- [X] ë“±ë¡ ìƒí’ˆ ì¡°íšŒ(í˜ì´ì§•)
- [ ] ê²€ìƒ‰ ì¡°ê±´ ê¸°ëŠ¥
- [X] ìƒí’ˆ ìˆ˜ì • 
- [ ] ìƒí’ˆ ì‚­ì œ (ëª¨ë“  ì£¼ë¬¸ì´ ì™„ë£Œë˜ì–´ ìˆëŠ” ìƒíƒœì—¬ì•¼ í•œë‹¤)
- [ ] ì‚­ì œì‹œ ì—°ê´€ëœ ìƒí’ˆ ì´ë¯¸ì§€ë„ ì¼ê´„ ì‚­ì œ ì²˜ë¦¬
- [X] íŒë§¤ì ì •ë³´ ìˆ˜ì •
- [ ] ìƒí’ˆ ë“±ë¡ ì‹œ ì¹´í…Œê³ ë¦¬ ì„¤ì •

#### ì±… ìƒí’ˆ ê¸°ëŠ¥ (ìœ ì €)
- [X] ìƒí’ˆ ì¡°íšŒ(í˜ì´ì§•)
- [ ] ê²€ìƒ‰ ì¡°ê±´ ê¸°ëŠ¥
- [X] ë‹¨ì¼ ìƒí’ˆ ì¡°íšŒ(detail)

#### ì¹´í…Œê³ ë¦¬ ê¸°ëŠ¥ (ì–´ë“œë¯¼)
- [ ] ì¹´í…Œê³ ë¦¬ ë“±ë¡
- [ ] ì¹´í…Œê³ ë¦¬ ìˆ˜ì •
- [ ] ì¹´í…Œê³ ë¦¬ ì‚­ì œ

#### ì£¼ë¬¸ ê¸°ëŠ¥ (ìœ ì €)
- [ ] ì£¼ë¬¸ ë“±ë¡
- [ ] ì£¼ë¬¸ ì·¨ì†Œ
- [ ] ì£¼ë¬¸ ì¡°íšŒ
- [ ] ì£¼ë¬¸ ë°°ë‹¬ ì¡°íšŒ

#### ë°°ë‹¬ ê¸°ëŠ¥ (ìœ ì €)
- [ ] ë°°ë‹¬ ë“±ë¡
- [ ] ë°°ë‹¬ ì·¨ì†Œ

#### ì¥ë°”êµ¬ë‹ˆ ê¸°ëŠ¥ (ìœ ì €)
- [ ] ì¥ë°”êµ¬ë‹ˆ ë“±ë¡(ì±…)
- [ ] ì¥ë°”êµ¬ë‹ˆ ì‚­ì œ
- [ ] ì¥ë°”êµ¬ë‹ˆ ìˆ˜ì •
- [ ] ì¥ë°”êµ¬ë‹ˆ ì¡°íšŒ

<hr/>

### ğŸ” í”„ë¡œì íŠ¸ ìƒì„¸

#### ERD-Cloud
![image-erd](./md_resource/image-erd.png)

<hr/>

### ğŸŒ³ ê°œë°œ í™˜ê²½

- Project: Gradle
- SpringBoot: 3.2.4
- Language: Java 17
- Dependencies
  - spring-boot-starter-data-jpa
  - querydsl-jpa:5.0.0:jakarta
  - p6spy-spring-boot-starter:1.9.0
  - thymeleaf-extras-springsecurity6
  - spring-boot-starter-security
  - spring-boot-starter-web
  - spring-boot-starter-validation
  - spring-boot-starter-thymeleaf
  - spring-boot-starter-test
  - com.mysql:mysql-connector-j
  - lombok

<br/>
<hr/>

### ë°°í¬ ê³¼ì •
#### ì‚¬ìš© íˆ´
- VMWare Workstation 17 player, Putty, FileZilla
- HostOS: Windows 11
- guestOS: CentOS Stream 9

#### ë²„ì „
- nginx: 1.20.1
- MySQL: 8.4.1
- JDK: 17.0.6

#### ìˆœì„œ
1. ê°€ìƒ OS VM Ware í”„ë¡œê·¸ë¨ ì„¤ì¹˜
2. ìš´ì˜ì²´ì œ CentOS Stream 9 ì„¤ì¹˜
3. Puttyë¡œ ì ‘ì†í•  ê´€ë¦¬ì ê³„ì • ìƒì„±
4. ì ‘ì†ì€ ì™¸ë¶€ ì„œë²„ê°€ ìˆë‹¤ê³  ê°€ì •í•˜ì—¬ Puttyë¡œ SSH ì ‘ì† ë° íŒŒì¼ì€ FileZillaë¥¼ í†µí•´ íŒŒì¼ ì˜®ê¸°ê¸°
5. Java Development Kit(JDK) ì„¤ì¹˜
6. nginx ì„¤ì¹˜, ì ‘ì† í…ŒìŠ¤íŠ¸
7. Host OS ê³µìœ ê¸°ì— í¬íŠ¸ í¬ì›Œë”© ì„¤ì •(80, 443), VMWare í¬íŠ¸ í¬ì›Œë”© ì„¤ì •(80, 443 ì™¸ë¶€ ì ‘ì† í—ˆìš©)
8. Firewall(ë°©í™”ë²½) 80, 443 í¬íŠ¸ ì—´ê¸°
9. 'ë‚´ë„ë©”ì¸.í•œêµ­' ë¬´ë£Œ DNS ì‚¬ìš© ë° Host ì™¸ë¶€ IP ì—°ê²°
10. MySQL ì„¤ì¹˜ ë° ê³„ì • ìƒì„±, ë°ì´í„°ë² ì´ìŠ¤ ìƒì„± ë° í…Œì´ë¸” ì¶”ê°€
11. Spring Boot ì´ìš©í•˜ì—¬ ë¹Œë“œ(BootJar) í›„ íŒŒì¼ systemctl(ì„œë¹„ìŠ¤) ë“±ë¡
12. Certbot ì´ìš©í•˜ì—¬ ë¬´ë£Œ lets' encrypt SSL/TLS ì„¤ì¹˜ ë° nginx.conf íŒŒì¼ ì„¤ì •
13. ì„œë¹„ìŠ¤ ì‹¤í–‰ ë° ì™¸ë¶€ ì‚¬ìš©ì ì ‘ì† í…ŒìŠ¤íŠ¸

#### nginx.conf
```nginx
user nginx;
worker_processes auto;
error_log /var/log/nginx/error.log;
pid /run/nginx.pid;

events {
    worker_connections 1024;
}

http {
    client_max_body_size 10M;

    upstream app {
       server 127.0.0.1:8080;
    }

    underscores_in_headers on;
    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    # Redirect all Traffic to HTTPS
    server {
      listen 80;

	  location ~ /\.well-known/acme-challenge/ {
	  	allow all;
		root /var/www/letsencrypt;
	  }

      return 301 https://$host$request_uri;
    }
 
    server {
      listen 443 ssl http2;
      ssl_certificate /etc/letsencrypt/live/nineto6.p-e.kr/fullchain.pem;
      ssl_certificate_key /etc/letsencrypt/live/nineto6.p-e.kr/privkey.pem;

      # Disable SSL
      ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
     
      # í†µì‹ ê³¼ì •ì—ì„œ ì‚¬ìš©í•  ì•”í˜¸í™” ì•Œê³ ë¦¬ì¦˜
      ssl_prefer_server_ciphers on;
      ssl_ciphers ECDH+AESGCM:ECDH+AES256:ECDH+AES128:DH+3DES:!ADH:!AECDH:!MD5;

      # Enable HSTS
      # clientì˜ browserì—ê²Œ httpë¡œ ì–´ë– í•œ ê²ƒë„ loadí•˜ì§€ ë§ë¼ê³  ê·œì œí•©ë‹ˆë‹¤.
      add_header Strict-Transport-Security "max-age=31536000" always;

      # SSL sessions
      ssl_session_cache shared:SSL:10m;
      ssl_session_timeout 10m;
    
      # Back-End Websocket
      location ^~/api/ws/ {
        proxy_pass http://app;
 
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "Upgrade";
        proxy_set_header Host $host;
      }

      # Back-End API
      location ^~/api/ {
        proxy_pass http://app;
        proxy_set_header Host $host;
        proxy_set_header X-Nginx-Proxy true;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
      }

      # Front-End React
      location / {
        root /home/ikavon/react/build;
        index index.html;
      	try_files $uri $uri/ /index.html;
      } 
    }
}
```

#### 96talk.service
```
[Unit]
Description=BookStore Description
After=syslog.target network.target bookstore.service

[Service]
ExecStart=/bin/bash -c "exec java -jar /home/ikavon/server/bookstore/book-0.0.1-SNAPSHOT.jar --spring.profiles.active=prod"
Restart=on-failure
RestartSec=10

User=root
group=root

[Install]
WantedBy=multi-user.taget
```